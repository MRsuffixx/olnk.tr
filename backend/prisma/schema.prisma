generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String    @id @default(uuid())
  email          String    @unique
  username       String    @unique
  password       String
  refreshToken   String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  profile        Profile?

  @@index([email])
  @@index([username])
}

model Profile {
  id             String    @id @default(uuid())
  userId         String    @unique
  displayName    String?
  bio            String?
  avatarUrl      String?
  theme          Json      @default("{\"primaryColor\":\"#6366f1\",\"backgroundColor\":\"#0f172a\",\"textColor\":\"#f8fafc\",\"fontFamily\":\"Inter\",\"cardStyle\":\"glass\"}")
  layoutConfig   Json      @default("{\"direction\":\"vertical\",\"spacing\":\"md\",\"maxWidth\":\"640px\"}")
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  widgets        Widget[]
  analytics      AnalyticsEvent[]

  @@index([userId])
}

enum WidgetType {
  LINK
  TEXT
  IMAGE
  SOCIAL
}

model Widget {
  id             String     @id @default(uuid())
  profileId      String
  type           WidgetType
  config         Json
  order          Int        @default(0)
  isVisible      Boolean    @default(true)
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  profile        Profile    @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([profileId, order])
}

enum AnalyticsEventType {
  PAGE_VIEW
  LINK_CLICK
}

model AnalyticsEvent {
  id             String             @id @default(uuid())
  profileId      String
  eventType      AnalyticsEventType
  ipHash         String
  userAgent      String?
  referrer       String?
  metadata       Json?
  createdAt      DateTime           @default(now())

  profile        Profile            @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([profileId, eventType])
  @@index([createdAt])
  @@index([profileId, createdAt])
}
